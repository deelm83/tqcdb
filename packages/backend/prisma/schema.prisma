generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model General {
  id                    String                 @id
  slug                  String                 @unique
  name                  String                 @map("name")
  factionId             String                 @map("faction_id")
  cost                  Int
  wikiUrl               String?                @map("wiki_url")
  image                 String?
  imageFull             String?                @map("image_full")
  tags                  String[]               @map("tags")
  cavalryGrade          String?                @map("cavalry_grade")
  shieldGrade           String?                @map("shield_grade")
  archerGrade           String?                @map("archer_grade")
  spearGrade            String?                @map("spear_grade")
  siegeGrade            String?                @map("siege_grade")
  innateSkillId         Int?                   @map("innate_skill_id")
  inheritedSkillId      Int?                   @map("inherited_skill_id")
  innateSkillName       String?                @map("innate_skill_name")
  inheritedSkillName    String?                @map("inherited_skill_name")
  status                String                 @default("needs_update")
  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")
  baseAttack            Float?                 @map("base_attack")
  baseCharm             Float?                 @map("base_charm")
  baseCommand           Float?                 @map("base_command")
  baseIntelligence      Float?                 @map("base_intelligence")
  basePolitics          Float?                 @map("base_politics")
  baseSpeed             Float?                 @map("base_speed")
  growthAttack          Float?                 @map("growth_attack")
  growthCharm           Float?                 @map("growth_charm")
  growthCommand         Float?                 @map("growth_command")
  growthIntelligence    Float?                 @map("growth_intelligence")
  growthPolitics        Float?                 @map("growth_politics")
  growthSpeed           Float?                 @map("growth_speed")
  rarity                String?
  refScreenshot         String?                @map("ref_screenshot")
  inheritedSkill        Skill?                 @relation("InheritedSkill", fields: [inheritedSkillId], references: [id])
  innateSkill           Skill?                 @relation("InnateSkill", fields: [innateSkillId], references: [id])
  exchangeableForSkills SkillExchangeGeneral[]
  inheritSkillSources   SkillInheritGeneral[]
  innateSkillSources    SkillInnateGeneral[]

  @@map("generals")
}

model Skill {
  id                          Int                    @id @default(autoincrement())
  slug                        String?                @unique
  name                        String                 @map("name")
  typeId                      String                 @map("type_id")
  typeName                    String?                @map("type_name")
  quality                     String?
  triggerRate                 Int?                   @map("trigger_rate")
  sourceType                  String?                @map("source_type")
  wikiUrl                     String?                @map("wiki_url")
  effect                      String?                @map("effect")
  target                      String?
  armyTypes                   String[]               @map("army_types")
  innateToGeneralNames        String[]               @map("innate_to_generals")
  inheritanceFromGeneralNames String[]               @map("inheritance_from_generals")
  acquisitionType             String?                @map("acquisition_type")
  exchangeType                String?                @map("exchange_type")
  exchangeGenerals            String[]               @map("exchange_generals")
  exchangeCount               Int?                   @map("exchange_count")
  status                      String                 @default("needs_update")
  screenshots                 String[]               @default([])
  createdAt                   DateTime               @default(now()) @map("created_at")
  updatedAt                   DateTime               @updatedAt @map("updated_at")
  inheritedByGenerals         General[]              @relation("InheritedSkill")
  innateToGenerals            General[]              @relation("InnateSkill")
  exchangeGeneralRelations    SkillExchangeGeneral[]
  inheritGeneralRelations     SkillInheritGeneral[]
  innateGeneralRelations      SkillInnateGeneral[]

  @@map("skills")
}

model SkillExchangeGeneral {
  id        Int      @id @default(autoincrement())
  skillId   Int      @map("skill_id")
  generalId String   @map("general_id")
  createdAt DateTime @default(now()) @map("created_at")
  general   General  @relation(fields: [generalId], references: [id], onDelete: Cascade)
  skill     Skill    @relation(fields: [skillId], references: [id], onDelete: Cascade)

  @@unique([skillId, generalId])
  @@map("skill_exchange_generals")
}

model SkillInnateGeneral {
  id        Int      @id @default(autoincrement())
  skillId   Int      @map("skill_id")
  generalId String   @map("general_id")
  createdAt DateTime @default(now()) @map("created_at")
  general   General  @relation(fields: [generalId], references: [id], onDelete: Cascade)
  skill     Skill    @relation(fields: [skillId], references: [id], onDelete: Cascade)

  @@unique([skillId, generalId])
  @@map("skill_innate_generals")
}

model SkillInheritGeneral {
  id        Int      @id @default(autoincrement())
  skillId   Int      @map("skill_id")
  generalId String   @map("general_id")
  createdAt DateTime @default(now()) @map("created_at")
  general   General  @relation(fields: [generalId], references: [id], onDelete: Cascade)
  skill     Skill    @relation(fields: [skillId], references: [id], onDelete: Cascade)

  @@unique([skillId, generalId])
  @@map("skill_inherit_generals")
}
